define(function(){return function(n){(function(d){d.keyboard=function(b,e){var a=this,c;a.$el=d(b);a.el=b;a.$el.data("keyboard",a);a.init=function(){a.options=c=d.extend(!0,{},d.keyboard.defaultOptions,e);a.shiftActive=a.altActive=a.metaActive=a.sets=a.capsLock=!1;a.lastKeyset=[!1,!1,!1];a.rows=["","-shift","-alt","-alt-shift"];a.acceptedKeys=[];a.mappedKeys={};a.allie=void 0===d.browser.msie?!1:!0;a.msie=a.allie&&9>parseInt(d.browser.version);a.inPlaceholder=a.$el.attr("placeholder")||"";a.watermark=
"undefined"!==typeof document.createElement("input").placeholder&&""!==a.inPlaceholder;a.regex=d.keyboard.comboRegex;a.decimal=/^\./.test(c.display.dec)?!0:!1;a.repeatTime=1E3/c.repeatRate;a.temp=d('<input style="position:absolute;left:-9999em;top:-9999em;" type="text" value="testing">').appendTo("body").caret(3,3);a.checkCaret=c.lockInput||3!==a.temp.hide().show().caret().start?!0:!1;a.temp.remove();a.lastCaret={start:0,end:0};a.temp=["",0,0];d.each("initialized,visible,change,hidden,canceled,accepted,beforeClose".split(","),
function(h,f){d.isFunction(c[f])&&a.$el.bind(f+".keyboard",c[f])});c.alwaysOpen&&(c.stayOpen=!0);c.stayOpen||d(document).bind("mousedown.keyboard keyup.keyboard",function(c){a.escClose(c)});a.$el.addClass("ui-keyboard-input "+c.css.input).attr({"aria-haspopup":"true",role:"textbox"});(a.$el.is(":disabled")||a.$el.attr("readonly"))&&a.$el.addClass("ui-keyboard-nokeyboard");c.openOn&&a.$el.bind(c.openOn+".keyboard",function(){a.focusOn()});!a.watermark&&""===a.$el.val()&&""!==a.inPlaceholder&&""!==
a.$el.attr("placeholder")&&a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder);a.$el.trigger("initialized.keyboard",[a,a.el]);c.alwaysOpen&&a.reveal()};a.focusOn=function(){a.$el.is(":visible")&&(a.lastCaret=a.$el.caret());if(!a.isVisible||c.alwaysOpen)clearTimeout(a.timer),a.reveal(),setTimeout(function(){a.$preview.focus()},100)};a.reveal=function(){d(".ui-keyboard:not(.ui-keyboard-always-open)").hide();d(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus");d(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current");
if(a.$el.is(":disabled")||a.$el.attr("readonly"))a.$el.addClass("ui-keyboard-nokeyboard");else{a.$el.removeClass("ui-keyboard-nokeyboard");c.usePreview||a.$el.unbind(c.openOn?c.openOn+".keyboard":"");"undefined"===typeof a.$keyboard&&a.startup();!a.watermark&&a.el.value===a.inPlaceholder&&a.$el.removeClass("ui-keyboard-placeholder").val("");a.originalContent=a.$el.val();a.$preview.val(a.originalContent);c.acceptValid&&a.checkValid();var h,f=c.position;f.of=f.of||a.$el.data("keyboardPosition")||a.$el;
f.collision=c.usePreview?f.collision||"fit fit":"flip flip";a.$el.addClass("ui-keyboard-input-current");a.isCurrent=!0;a.$keyboard.css({position:"absolute",left:0,top:0}).addClass("ui-keyboard-has-focus").show();c.usePreview&&a.msie&&("undefined"===typeof a.width&&(a.$preview.hide(),a.width=Math.ceil(a.$keyboard.width()),a.$preview.show()),a.$preview.width(a.width));a.$keyboard.position(f);d(window).resize(function(){a.isVisible&&a.$keyboard.position(f)});a.$preview.focus();a.isVisible=!0;a.checkDecimal();
a.lineHeight=parseInt(a.$preview.css("lineHeight"),10)||parseInt(a.$preview.css("font-size"),10)+4;a.allie&&(h=a.lastCaret.start||a.originalContent.length,h={start:h,end:h},a.lastCaret||(a.lastCaret=h),0===a.lastCaret.end&&0<a.lastCaret.start&&(a.lastCaret.end=a.lastCaret.start),0>a.lastCaret.start&&(a.lastCaret=h));a.$preview.caret(a.lastCaret.start,a.lastCaret.end);a.$el.trigger("visible.keyboard",[a,a.el]);return a}};a.startup=function(){a.$keyboard=a.buildKeyboard();a.$allKeys=a.$keyboard.find("button.ui-keyboard-button");
a.$preview=c.usePreview?a.$keyboard.find(".ui-keyboard-preview"):a.$el;a.preview=a.$preview[0];a.$decBtn=a.$keyboard.find(".ui-keyboard-dec");a.wheel=d.isFunction(d.fn.mousewheel);a.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];c.enterNavigation&&a.alwaysAllowed.push(13);a.$preview.bind("keypress.keyboard",function(h){var f=String.fromCharCode(h.charCode||h.which);a.checkCaret&&(a.lastCaret=a.$preview.caret());a.capsLock=65<=f&&90>=f&&!h.shiftKey||97<=f&&122>=f&&h.shiftKey?!0:!1;if(c.restrictInput){if((8===
h.which||0===h.which)&&d.inArray(h.keyCode,a.alwaysAllowed))return;-1===d.inArray(f,a.acceptedKeys)&&h.preventDefault()}else if((h.ctrlKey||h.metaKey)&&(97===h.which||99===h.which||118===h.which||120<=h.which&&122>=h.which))return;a.hasMappedKeys&&a.mappedKeys.hasOwnProperty(f)&&(a.insertText(a.mappedKeys[f]),h.preventDefault());a.checkMaxLength()}).bind("keyup.keyboard",function(h){switch(h.which){case 9:a.tab&&!c.lockInput?(d.keyboard.keyaction.tab(a),a.tab=!1):h.preventDefault();break;case 27:return a.close(),
!1}clearTimeout(a.throttled);a.throttled=setTimeout(function(){a.checkCombos()},100);a.checkMaxLength();a.$el.trigger("change.keyboard",[a,a.el])}).bind("keydown.keyboard",function(h){switch(h.which){case 9:if(c.tabNavigation){a.close(c.autoAccept);break}else return a.tab=!0,!1;case 13:d.keyboard.keyaction.enter(a,null,h);break;case 20:a.shiftActive=a.capsLock=!a.capsLock;a.showKeySet(this);break;case 86:if(h.ctrlKey||h.metaKey){if(c.preventPaste){h.preventDefault();break}a.checkCombos()}}}).bind("mouseup.keyboard",
function(){a.checkCaret&&(a.lastCaret=a.$preview.caret())}).bind("blur.keyboard",function(){if(c.alwaysOpen&&a.isCurrent&&!a.$el.hasClass("ui-keyboard-input-current"))return clearTimeout(a.timer),a.timer=setTimeout(function(){a.isCurrent&&!a.$el.hasClass("ui-keyboard-input-current")&&a.close(c.autoAccept)},300),!1});c.preventPaste&&(a.$preview.bind("contextmenu.keyboard",function(a){a.preventDefault()}),a.$el.bind("contextmenu.keyboard",function(a){a.preventDefault()}));c.appendLocally?a.$el.after(a.$keyboard):
a.$keyboard.appendTo("body");a.$allKeys.bind(c.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(h){var f;f=d.data(this,"key");var b=f.action.split(":")[0];a.$preview.focus();a.checkCaret&&a.$preview.caret(a.lastCaret.start,a.lastCaret.end);b.match("meta")&&(b="meta");if(d.keyboard.keyaction.hasOwnProperty(b)&&d(this).hasClass("ui-keyboard-actionkey")){if(!1===d.keyboard.keyaction[b](a,this,h))return}else"undefined"!==typeof f.action&&(f=a.wheel&&!d(this).hasClass("ui-keyboard-actionkey")?
f.curTxt:f.action,a.insertText(f),!a.capsLock&&!c.stickyShift&&!h.shiftKey&&(a.shiftActive=!1,a.showKeySet(this)));a.checkCombos();a.checkMaxLength();a.$el.trigger("change.keyboard",[a,a.el]);a.$preview.focus();h.preventDefault()}).bind("mouseenter.keyboard mouseleave.keyboard",function(h){var f=d(this),b=d.data(this,"key");"mouseenter"===h.type&&"password"!==a.el.type&&f.addClass(c.css.buttonHover).attr("title",function(h,f){return a.wheel&&""===f&&a.sets?c.wheelMessage:f});"mouseleave"===h.type&&
(b.curTxt=b.original,b.curNum=0,d.data(this,"key",b),f.removeClass("password"===a.el.type?"":c.css.buttonHover).attr("title",function(a,h){return h===c.wheelMessage?"":h}).find("span").text(b.original))}).bind("mousewheel.keyboard",function(c,f){if(a.wheel){var b,g=d(this),e=d.data(this,"key");b=e.layers||a.getLayers(g);e.curNum+=0<f?-1:1;e.curNum>b.length-1&&(e.curNum=0);0>e.curNum&&(e.curNum=b.length-1);e.layers=b;e.curTxt=b[e.curNum];d.data(this,"key",e);g.find("span").text(b[e.curNum]);return!1}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",
function(){a.isVisible&&a.$preview.focus();a.mouseRepeat=[!1,""];return!1}).filter(":not(.ui-keyboard-actionkey)").add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",a.$keyboard).bind("mousedown.kb touchstart.kb",function(){var h=d(this);a.mouseRepeat=[!0,h];setTimeout(function(){a.mouseRepeat[0]&&a.mouseRepeat[1]===h&&a.repeatKey(h)},c.repeatDelay);return!1})};a.insertText=function(c){var b,d;d=a.$preview.val();var g=a.$preview.caret(),e=a.$preview.scrollLeft();b=a.$preview.scrollTop();
var i=d.length;g.end<g.start&&(g.end=g.start);g.start>i&&(g.end=g.start=i);"TEXTAREA"===a.preview.tagName&&(a.msie&&"\n"===d.substr(g.start,1)&&(g.start+=1,g.end+=1),d=d.split("\n").length-1,a.preview.scrollTop=0<d?a.lineHeight*d:b);b="bksp"===c&&g.start===g.end?!0:!1;c="bksp"===c?"":c;d=g.start+(b?-1:c.length);e+=parseInt(a.$preview.css("fontSize"),10)*("bksp"===c?-1:1);a.$preview.val(a.$preview.val().substr(0,g.start-(b?1:0))+c+a.$preview.val().substr(g.end)).caret(d,d).scrollLeft(e);a.checkCaret&&
(a.lastCaret={start:d,end:d})};a.checkMaxLength=function(){var h,b=a.$preview.val();!1!==c.maxLength&&b.length>c.maxLength&&(h=Math.min(a.$preview.caret().start,c.maxLength),a.$preview.val(b.substring(0,c.maxLength)),a.$preview.caret(h,h),a.lastCaret={start:h,end:h});a.$decBtn.length&&a.checkDecimal()};a.repeatKey=function(c){c.trigger("repeater.keyboard");a.mouseRepeat[0]&&setTimeout(function(){a.repeatKey(c)},a.repeatTime)};a.showKeySet=function(h){var b="",d=(a.shiftActive?1:0)+(a.altActive?2:
0);a.shiftActive||(a.capsLock=!1);if(a.metaActive){if(b=h&&h.name&&/meta/.test(h.name)?h.name:"",""===b?b=!0===a.metaActive?"":a.metaActive:a.metaActive=b,!c.stickyShift&&a.lastKeyset[2]!==a.metaActive||(a.shiftActive||a.altActive)&&!a.$keyboard.find(".ui-keyboard-keyset-"+b+a.rows[d]).length)a.shiftActive=a.altActive=!1}else!c.stickyShift&&a.lastKeyset[2]!==a.metaActive&&a.shiftActive&&(a.shiftActive=a.altActive=!1);d=(a.shiftActive?1:0)+(a.altActive?2:0);b=0===d&&!a.metaActive?"-default":""===b?
"":"-"+b;a.$keyboard.find(".ui-keyboard-keyset"+b+a.rows[d]).length?(a.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(c.css.buttonAction).end().find(".ui-keyboard-alt")[a.altActive?"addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-shift")[a.shiftActive?"addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-lock")[a.capsLock?"addClass":"removeClass"](c.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+
b+a.rows[d]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+b).addClass(c.css.buttonAction),a.lastKeyset=[a.shiftActive,a.altActive,a.metaActive]):(a.shiftActive=a.lastKeyset[0],a.altActive=a.lastKeyset[1],a.metaActive=a.lastKeyset[2])};a.checkCombos=function(){var b,f,d,e,j=a.$preview.val(),i=a.$preview.caret(),l=j.length;i.end<i.start&&(i.end=i.start);i.start>l&&(i.end=i.start=l);a.msie&&"\n"===j.substr(i.start,1)&&(i.start+=1,i.end+=1);c.useCombos&&(j=j.replace(a.regex,function(a,b,h){return c.combos.hasOwnProperty(b)?
c.combos[b][h]||a:a}));if(c.restrictInput&&""!==j){d=j;f=a.acceptedKeys.length;for(b=0;b<f;b++)""!==d&&(e=a.acceptedKeys[b],0<=j.indexOf(e)&&(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(e)&&(e="\\"+e),d=d.replace(RegExp(e,"g"),"")));""!==d&&(j=j.replace(d,""))}i.start+=j.length-l;i.end+=j.length-l;a.$preview.val(j);a.$preview.caret(i.start,i.end);a.preview.scrollTop=a.lineHeight*(j.substring(0,i.start).split("\n").length-1);a.lastCaret={start:i.start,end:i.end};c.acceptValid&&a.checkValid();
return j};a.checkValid=function(){var b=!0;c.validate&&"function"===typeof c.validate&&(b=c.validate(a,a.$preview.val(),!1));a.$keyboard.find(".ui-keyboard-accept")[b?"removeClass":"addClass"]("disabled")[b?"removeAttr":"attr"]("disabled","disabled").attr("aria-disabled",!b)};a.checkDecimal=function(){a.decimal&&/\./g.test(a.preview.value)||!a.decimal&&/\,/g.test(a.preview.value)?a.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(c.css.buttonDefault+" "+c.css.buttonHover).addClass(c.css.buttonDisabled):
a.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(c.css.buttonDefault).removeClass(c.css.buttonDisabled)};a.getLayers=function(a){var c;c=a.attr("data-pos");return a.closest(".ui-keyboard").find('button[data-pos="'+c+'"]').map(function(){return d(this).find("> span").text()}).get()};a.switchInput=function(b,f){if("function"===typeof c.switchInput)c.switchInput(a,b,f);else{a.close(f);var e=d(".ui-keyboard-input:not(.ui-keyboard-preview)"),g=e.index(a.$el)+(b?1:-1);g>e.length-
1&&(g=0);e.eq(g).focus()}return!1};a.close=function(b){if(a.isVisible){clearTimeout(a.throttled);a.isCurrent=!1;var f=b?a.checkCombos():a.originalContent;if(b&&c.validate&&"function"===typeof c.validate&&!c.validate(a,f,!0))return;a.$el.removeClass("ui-keyboard-input-current").trigger(c.alwaysOpen?"":"beforeClose.keyboard",[a,a.el,b||!1]).val(f).scrollTop(a.el.scrollHeight).trigger(b?"accepted.keyboard":"canceled.keyboard",[a,a.el]).trigger(c.alwaysOpen?"inactive.keyboard":"hidden.keyboard",[a,a.el]);
!c.usePreview&&""!==c.openOn&&a.$el.bind(c.openOn+".keyboard",function(){a.focusOn()});c.alwaysOpen||(a.$keyboard.hide(),a.isVisible=!1);!a.watermark&&""===a.el.value&&""!==a.inPlaceholder&&a.$el.addClass("ui-keyboard-placeholder").val(a.inPlaceholder)}return!1};a.accept=function(){a.close(!0)};a.escClose=function(b){a.isVisible&&("keyup"===b.type&&27===b.which&&a.close(),"mousedown"===b.type&&b.target!==a.el&&d(b.target).closest(".ui-keyboard")[0]!==a.$keyboard[0]&&(a.allie&&b.preventDefault(),a.close(c.autoAccept)))};
a.keyBtn=d("<button />").attr({role:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button");a.addKey=function(b,f,e){var g,j,i,f=!0===e?b:c.display[f]||b,l=!0===e?b.charCodeAt(0):b;/\(.+\)/.test(f)&&(j=f.replace(/\(([^()]+)\)/,""),g=f.match(/\(([^()]+)\)/)[1],f=j,i=j.split(":"),j=""!==i[0]&&1<i.length?i[0]:j,a.mappedKeys[g]=j);i=f.split(":");""===i[0]&&""===i[1]&&(f=":");f=""!==i[0]&&1<i.length?d.trim(i[0]):f;g=1<i.length?d.trim(i[1]).replace(/_/g," ")||"":"";j=1<f.length?
" ui-keyboard-widekey":"";j+=e?"":" ui-keyboard-actionkey";return a.keyBtn.clone().attr({"data-value":f,name:l,"data-pos":a.temp[1]+","+a.temp[2],title:g}).data("key",{action:b,original:f,curTxt:f,curNum:0}).addClass("ui-keyboard-"+l+j+" "+c.css.buttonDefault).html("<span>"+f+"</span>").appendTo(a.temp[0])};a.buildKeyboard=function(){var b,f,e,g,j,i,l,m=0,n=d("<div />").addClass("ui-keyboard "+c.css.container+(c.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();c.usePreview?
a.$preview=a.$el.clone(!1).removeAttr("id").removeClass("ui-keyboard-placeholder").addClass("ui-keyboard-preview "+c.css.input).show():(a.$preview=a.$el,c.position.at=c.position.at2);a.$preview.attr(c.lockInput?{readonly:"readonly"}:{});c.usePreview&&d("<div />").addClass("ui-keyboard-preview-wrapper").append(a.$preview).appendTo(n);if("custom"===c.layout||!d.keyboard.layouts.hasOwnProperty(c.layout))c.layout="custom",d.keyboard.layouts.custom=c.customLayout||{"default":["{cancel}"]};d.each(d.keyboard.layouts[c.layout],
function(o,p){if(""!==o){m++;e=d("<div />").attr("name",o).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+o).appendTo(n)["default"===o?"show":"hide"]();for(f=0;f<p.length;f++){g=d.trim(p[f]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");i=g.split(/\s+/);for(j=0;j<i.length;j++)if(a.temp=[e,f,j],0!==i[j].length)if(/^\{\S+\}$/.test(i[j]))if(b=i[j].match(/^\{(\S+)\}$/)[1].toLowerCase(),/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/.test(b)&&(l=parseFloat(b.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||
0),d("<span>&nbsp;</span>").width(b.match("px")?l+"px":2*l+"em").addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(e)),/^meta\d+\:?(\w+)?/.test(b))a.addKey(b,b);else switch(b){case "a":case "accept":a.addKey("accept",b).addClass(c.css.buttonAction);break;case "alt":case "altgr":a.addKey("alt","alt");break;case "b":case "bksp":a.addKey("bksp",b);break;case "c":case "cancel":a.addKey("cancel",b).addClass(c.css.buttonAction);break;case "combo":a.addKey("combo","combo").addClass(c.css.buttonAction);
break;case "dec":a.acceptedKeys.push(a.decimal?".":",");a.addKey("dec","dec");break;case "e":case "enter":a.addKey("enter",b).addClass(c.css.buttonAction);break;case "s":case "shift":a.addKey("shift",b);break;case "sign":a.acceptedKeys.push("-");a.addKey("sign","sign");break;case "space":a.acceptedKeys.push(" ");a.addKey("space","space");break;case "t":case "tab":a.addKey("tab",b);break;default:d.keyboard.keyaction.hasOwnProperty(b)&&a.addKey(b,b)}else a.acceptedKeys.push(i[j].split(":")[0]),a.addKey(i[j],
i[j],!0);e.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}});1<m&&(a.sets=!0);a.hasMappedKeys=!d.isEmptyObject(a.mappedKeys);return n};a.destroy=function(){d(document).unbind("mousedown.keyboard keyup.keyboard");a.$keyboard&&a.$keyboard.remove();var b=c.openOn+",accepted,beforeClose,blur,canceled,change,contextmenu,hidden,initialized,keydown,keypress,keyup,visible".split(",").join(".keyboard ");a.$el.removeClass("ui-keyboard-input ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+
c.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(b+".keyboard").removeData("keyboard")};a.init()};d.keyboard.keyaction={accept:function(b){b.close(!0);return!1},alt:function(b,d){b.altActive=!b.altActive;b.showKeySet(d)},bksp:function(b){b.insertText("bksp")},cancel:function(b){b.close();return!1},clear:function(b){b.$preview.val("")},combo:function(b){var d=!b.options.useCombos;b.options.useCombos=d;b.$keyboard.find(".ui-keyboard-combo")[d?"addClass":"removeClass"](b.options.css.buttonAction);
d&&b.checkCombos();return!1},dec:function(b){b.insertText(b.decimal?".":",")},enter:function(b,e,a){var e=b.el.tagName,c=b.options;if(a.shiftKey)return c.enterNavigation?b.switchInput(!a[c.enterMod],!0):b.close(!0);if(c.enterNavigation&&("TEXTAREA"!==e||a[c.enterMod]))return b.switchInput(!a[c.enterMod],c.autoAccept);"TEXTAREA"===e&&d(a.target).closest("button").length&&b.insertText("\n")},lock:function(b,d){b.lastKeyset[0]=b.shiftActive=b.capsLock=!b.capsLock;b.showKeySet(d)},meta:function(b,e){b.metaActive=
d(e).hasClass(b.options.css.buttonAction)?!1:!0;b.showKeySet(e)},shift:function(b,d){b.lastKeyset[0]=b.shiftActive=!b.shiftActive;b.showKeySet(d)},sign:function(b){/^\-?\d*\.?\d*$/.test(b.$preview.val())&&b.$preview.val(-1*b.$preview.val())},space:function(b){b.insertText(" ")},tab:function(b){if("INPUT"===b.el.tagName)return!1;b.insertText("\t")}};d.keyboard.layouts={alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}",
"{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',
"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}",
"{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],
shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":"= ( ) {b},{clear} / * -,7 8 9 +,4 5 6 {sign},1 2 3 %,0 . {a} {c}".split(",")}};d.keyboard.defaultOptions={layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:!0,alwaysOpen:!1,stayOpen:!1,display:{a:"✔:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",
alt:"AltGr:Alternate Graphemes",b:"←:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"↵:Enter",enter:"Enter:Enter",lock:"⇪ Lock:Caps Lock",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",
buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled"},autoAccept:!1,lockInput:!1,restrictInput:!1,acceptValid:!1,tabNavigation:!1,enterNavigation:!1,enterMod:"altKey",appendLocally:!1,stickyShift:!0,preventPaste:!1,maxLength:!1,repeatDelay:500,repeatRate:20,openOn:"focus",keyBinding:"mousedown",useCombos:!0,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",
e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}},validate:function(){return!0}};d.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;d.fn.keyboard=function(b){return this.each(function(){d(this).data("keyboard")||new d.keyboard(this,b)})};d.fn.getkeyboard=
function(){return this.data("keyboard")}})(n);(function(d,b,e,a){d.fn.caret=function(c,d){if("undefined"===typeof this[0]||this.is(":hidden")||"hidden"===this.css("visibility"))return this;var f,k,g,j,i,l;f=document.selection;var m=this[0],n=m.scrollTop;l=window.opera&&"[object Opera]"===window.opera.toString();var o="undefined"!==typeof m.selectionStart;"number"===typeof c&&"number"===typeof d&&(g=c,i=d);if("undefined"!==typeof g)return o?("TEXTAREA"===m.tagName&&l&&(l=this.val(),f=l.substring(0,
g).split("\n")[b]-1,g+=0<f?f:0,i+=0<f?f:0),m.selectionStart=g,m.selectionEnd=i):(f=m.createTextRange(),f.collapse(!0),f.moveStart("character",g),f.moveEnd("character",i-g),f.select()),(this.is(":visible")||"hidden"!==this.css("visibility"))&&this.focus(),m.scrollTop=n,this;o?(k=m.selectionStart,j=m.selectionEnd,"TEXTAREA"===m.tagName&&l&&(l=this.val(),f=l.substring(0,k).split("\n")[b]-1,k+=0<f?-f:0,j+=0<f?-f:0)):"TEXTAREA"===m.tagName?(l=this.val(),g=f[e](),i=g[a](),i.moveToElementText(m),i.setEndPoint("EndToEnd",
g),k=i.text.replace(/\r\n/g,"\r")[b],j=k+g.text.replace(/\r\n/g,"\r")[b]):(l=this.val().replace(/\r\n/g,"\r"),g=f[e]()[a](),g.moveEnd("character",l[b]),k=""===g.text?l[b]:l.lastIndexOf(g.text),g=f[e]()[a](),g.moveStart("character",-l[b]),j=g.text[b]);g=m.value.substring(k,j);return{start:k,end:j,text:g,replace:function(a){return m.value.substring(0,k)+a+m.value.substring(j,m.value[b])}}}})(n,"length","createRange","duplicate");(function(d){d.fn.addAutocomplete=function(){return this.each(function(){var b=
d(this).data("keyboard");b&&(b.autocomplete_init=function(){b.options.alwaysOpen&&b.isVisible&&b.autocomplete_setup();b.$el.bind("visible.keyboard",function(){b.autocomplete_setup()}).bind("change.keyboard",function(){b.hasAutocomplete&&b.isVisible&&b.$el.val(b.$preview.val()).trigger("keydown.autocomplete")}).bind("hidden.keyboard",function(){b.$el.autocomplete("close")}).bind("autocompleteopen",function(){b.hasAutocomplete&&b.$el.data("autocomplete").menu.element.position({of:b.$keyboard,my:"right top",
at:"left top",collision:"flip"})}).bind("autocompleteselect",function(d,a){b.hasAutocomplete&&""!==a.item.value&&b.$preview.val(a.item.value).focus()})},b.autocomplete_setup=function(){b.$autocomplete=b.$el.data("autocomplete");b.hasAutocomplete="undefined"===typeof b.$autocomplete?!1:b.$autocomplete.options.disabled?!1:!0;b.hasAutocomplete&&!b.autocomplete_bind&&(b.$preview.bind("keydown.keyboard",function(d){return b.autocomplete_input(d)}),b.autocomplete_bind=!0)},b.autocomplete_input=function(e){var a;
a=d.ui.keyCode;switch(e.keyCode){case a.PAGE_UP:b.$autocomplete._move("previousPage",e);break;case a.PAGE_DOWN:b.$autocomplete._move("nextPage",e);break;case a.UP:b.$autocomplete._move("previous",e);e.preventDefault();break;case a.DOWN:b.$autocomplete._move("next",e);e.preventDefault();break;case a.ENTER:case a.NUMPAD_ENTER:a=b.$autocomplete.menu.element.find("#ui-active-menuitem").text()||"";""!==a&&b.$preview.val(a);break;default:clearTimeout(b.$autocomplete.searching),b.$autocomplete.searching=
setTimeout(function(){b.$autocomplete.term!=b.$autocomplete.element.val()&&(b.$autocomplete.selectedItem=null,b.$autocomplete.search(null,e))},b.$autocomplete.options.delay)}},b.origEscClose=b.escClose,b.escClose=function(d){b.hasAutocomplete&&"ui-active-menuitem"===d.target.id||b.origEscClose(d)},b.autocomplete_init())})}})(n);(function(d){d.fn.addMobile=function(b){var e,a={container:{theme:"a"},buttonMarkup:{theme:"a",shadow:"true",corners:"true"},buttonHover:{theme:"c"},buttonAction:{theme:"b"},
buttonActive:{theme:"e"}};return this.each(function(){var c=d(this).data("keyboard");c&&"undefined"!==typeof d.fn.textinput&&(c.mobile_options=e=d.extend({},a,b),c.mobile_initialized=!1,c.mobile_init=function(){d(".ui-keyboard-input").textinput();c.options.alwaysOpen&&c.isVisible&&c.mobile_setup();c.$el.bind("visible.keyboard",function(){!0!==c.mobile_initialized&&c.mobile_setup()})},c.mobile_setup=function(){var a;a=d.extend({},e.buttonMarkup,e.buttonAction);c.$keyboard.addClass("ui-bar ui-bar-"+
e.container.theme).removeClass("ui-widget ui-widget-content").find("button:not(."+c.options.css.buttonAction+")").addClass(c.modButton(e.buttonMarkup)).end().find("."+c.options.css.buttonAction).addClass(c.modButton(a)).end().find("button").removeClass("ui-corner-all ui-state-default").hover(function(){d(this).addClass("ui-btn-hover-"+e.buttonHover.theme)},function(){d(this).removeClass("ui-btn-hover-"+e.buttonHover.theme)});c.options.css.buttonAction="ui-btn-down-"+e.buttonActive.theme;c.msie&&c.$preview[0]!==
c.el&&(c.$preview.hide(),c.$keyboard.css("width",""),c.width=c.$keyboard.outerWidth(),c.$keyboard.width(c.width+parseInt(c.$preview.css("fontSize"),10)),c.$preview.width(c.width),c.$preview.show());a=c.options.position;a.of=a.of||c.$el.data("keyboardPosition")||c.$el;a.collision=c.options.usePreview?a.collision||"fit fit":"flip flip";c.$keyboard.position(a);c.mobile_initialized=!0},c.modButton=function(a){return"ui-btn ui-btn-up-"+a.theme+("true"==a.shadow?" ui-shadow":"")+("true"==a.corners?" ui-btn-corner-all":
"")},c.mobile_init())})}})(n);(function(d){d.fn.addNavigation=function(b){var e,a={position:[0,0],toggleMode:!1,toggleKey:112,focusClass:"hasFocus"};return this.each(function(){var c=d(this).data("keyboard");c&&(c.navigation_options=e=d.extend({},a,b),c.saveNav=[c.options.tabNavigation,c.options.enterNavigation],c.navigation_init=function(){c.$keyboard[e.toggleMode?"addClass":"removeClass"](e.focusClass).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+e.position[0]+","+e.position[1]+
'"]').addClass("ui-state-hover");c.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(a){return c.checkKeys(a)})},c.checkKeys=function(a,b){if(a.which===e.toggleKey||b)e.toggleMode=b?!1:!e.toggleMode,c.options.tabNavigation=e.toggleMode?!1:c.saveNav[0],c.options.enterNavigation=e.toggleMode?!1:c.saveNav[1];c.$keyboard[e.toggleMode?"addClass":"removeClass"](e.focusClass);if(e.toggleMode&&32<a.which&&41>a.which)return c.navigateKeys(a.which),!1;if(e.toggleMode&&13===a.which)return c.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+
e.position[0]+","+e.position[1]+'"]').trigger("repeater.keyboard"),!1},c.navigateKeys=function(a){var b=e.position[1],d=e.position[0],g=c.$keyboard.find(".ui-keyboard-keyset:visible"),j=g.find(".ui-keyboard-button-endrow").length-1,i=g.find('.ui-keyboard-button[data-pos^="'+d+',"]').length-1;parseInt(g.find(".ui-keyboard-button:last").attr("data-pos").split(",")[1],10);switch(a){case 33:d=0;break;case 34:d=j;break;case 35:b=i;break;case 36:b=0;break;case 37:b+=0<b?-1:0;break;case 38:d+=0<d?-1:0;break;
case 39:b+=1;break;case 40:d+=d+1>j?0:1}i=g.find('.ui-keyboard-button[data-pos^="'+d+',"]').length-1;b>i&&(b=i);g.find(".ui-state-hover").removeClass("ui-state-hover");g.find('.ui-keyboard-button[data-pos="'+d+","+b+'"]').addClass("ui-state-hover");e.position=[d,b]},c.options.alwaysOpen&&c.isVisible&&c.navigation_init(),c.$el.bind("visible.keyboard",function(){c.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(a){c.checkKeys(a,!0)}))})}})(n);(function(d){d.fn.addTyping=function(b){var e=
{showTyping:!0,delay:250};return this.each(function(){var a=d(this).data("keyboard");a&&(a.typing_options=d.extend({},e,b),a.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","":"bksp","\n":"Enter","\r":"Enter","\t":"tab"},a.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"},a.typing_event=a.typing_flag=!1,a.typing_setup=function(){a.typing_flag||(a.typing_flag=!0,(a.$preview?a.$preview:a.$el).bind("keyup.keyboard",function(b){if(!(37<=b.which&&40>=b.which)&&(16===b.which&&(a.shiftActive=
!1),18===b.which&&(a.altActive=!1),16===b.which||18===b.which))a.showKeySet(),setTimeout(function(){a.$preview.focus()},200)}).bind("keydown.keyboard",function(b){b.temp=!1;16===b.which&&(b.temp=a.shiftActive?!1:!0,a.shiftActive=!0);18===b.which&&(b.temp=a.altActive?!1:!0,a.altActive=!0);b.temp&&(a.showKeySet(),a.$preview.focus());a.typing_event=!0;if(8===b.which||9===b.which)a.typeIn("",a.typing_options.delay||250,function(){a.typing_event=!1},b)}).bind("keypress.keyboard",function(b){a.typing_event&&
!a.options.lockInput&&a.typeIn("",a.typing_options.delay||250,function(){a.typing_event=!1},b)}))},a.typeIn=function(b,e,f,k){if(a.isVisible){var g=a.typing_options;!0!==a.typing_options.init&&(g.init=!0,g.text=b,g.len=b.length,g.delay=e||300,g.current=0,g.callback=f);b=g.text.substring(g.current,++g.current);e=a.$keyboard.find(".ui-keyboard-keyset");f='.ui-keyboard-button[data-value="'+(a.typing_keymap.hasOwnProperty(b)?a.typing_keymap[b]:b)+'"]';a.typing_event&&k&&(a.typing_xref.hasOwnProperty(k.keyCode||
k.which)?f=".ui-keyboard-"+a.typing_xref[k.keyCode||k.which]:(f=String.fromCharCode(k.charCode||k.which),f=a.mappedKeys.hasOwnProperty(f)?'.ui-keyboard-button[data-value="'+a.mappedKeys[f]+'"]':".ui-keyboard-"+(k.charCode||k.which)));k=e.filter(":visible").find(f);k.length?a.typing_simulateKey(k,b):(a.typing_event?k=e.find(f):(k=a.typing_keymap.hasOwnProperty(b)?a.typing_keymap[b]:b.charCodeAt(0),"bksp"===k&&(b=k),k=e.find(".ui-keyboard-"+k)),e=k.closest(".ui-keyboard-keyset"),e.attr("name")?(e=e.attr("name"),
a.shiftActive=/shift/.test(e),a.altActive=/alt/.test(e),a.metaActive=a.lastKeyset[2]=e.match(/meta\d+/)||!1,a.showKeySet({name:a.metaActive}),a.typing_simulateKey(k,b)):a.typing_event||(a.insertText(b),a.checkCombos()));g.current<g.len?a.isVisible&&setTimeout(function(){a.typeIn()},g.delay):(g.init=!1,d.isFunction(g.callback)&&setTimeout(function(){g.callback()},g.delay))}else a.typing_options.init=!1,clearTimeout(a.typing_timer)},a.typing_simulateKey=function(b,d){var e=b.length;e&&b.filter(":visible").trigger("mouseenter.keyboard");
a.typing_timer=setTimeout(function(){e&&setTimeout(function(){b.trigger("mouseleave.keyboard")},a.typing_options.delay/3);a.isVisible&&!a.typing_event&&(a.insertText(d),a.checkCombos())},a.typing_options.delay/3)},a.typing_options.showTyping&&(a.options.alwaysOpen&&a.isVisible&&a.typing_setup(),a.$el.bind("visible.keyboard",function(){a.typing_setup()})))})}})(n)}});
