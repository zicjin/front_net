define("arale/select/2.0.0/select",["arale/overlay/0.9.12/overlay","$","arale/position/1.0.0/position","arale/iframe-shim/1.0.0/iframe-shim","arale/widget/1.0.2/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.2/templatable","gallery/handlebars/1.0.0/handlebars"],function(a,b,c){function i(a,b){var c,d=[],e=a.options,f=e.length,g=!1;for(c=0;f>c;c++){var h,i={},j=e[c],k=["text","value","defaultSelected","selected","disabled"];for(h in k){var l=k[h];i[l]=j[l]}i.defaultSelected=j.defaultSelected?"true":"false",j.selected?(i.selected="true",g=!0):i.selected="false",d.push(i)}return g||(newModel[0].selected="true"),{options:d,classPrefix:b}}function j(a,b,c){var d,e,f,g,h=[],i=!1;for(c||(c=[],i=!0),d=0,f=a.length;f>d;d++){var k=a[d];k.selected?(k.selected=k.defaultSelected="true",c.push(k)):k.selected=k.defaultSelected="false",k.options&&k.options.length>0&&(k.options=j(k.options,b,c).options),h.push(k)}if(i)if(c.length>0)for(c.pop(),e=0,g=c.length;g>e;e++)c[e].selected="false";else h[0].selected="true";return{options:h,classPrefix:b}}function k(a,b,c){var d;if(e.isNumeric(a))d=a;else{if(a=b.parent().find(a),0==a.length)return c?[]:-1;d=b.index(a)}if(0>d){e.each(b,function(b,c){return c=e(c),c.find(a).length>0?(d=b,!1):void 0});var f=k(a,b.eq(d).children("ul").children(),!0);return f instanceof Array||(f=[f]),[d].concat(f)}return c?[d]:d}function l(a,b){var d,c=a instanceof Array?a:[a];return e.each(c,function(a,c){d=b.eq(c),b=e("ul",d).children()}),d}function m(a,b){if(-1==a)return null;var d,c=a instanceof Array?a:[a];return e.each(c,function(a,c){d=b[c],b=d.options}),d}function n(a){var b=!1;return e.each(a,function(a,c){return e.isArray(c.options)&&c.options.length>0?(b=!0,!1):void 0}),b}var d=a("arale/overlay/0.9.12/overlay"),e=a("$"),f=a("arale/widget/1.0.2/templatable"),g='<div class="{{classPrefix}}">\n<ul class="{{classPrefix}}-content" data-role="content">\n{{#each options}}\n<li data-role="item" class="{{../classPrefix}}-item {{#if disabled}}{{../../classPrefix}}-item-disabled{{/if}}" data-value="{{value}}" data-default-selected="{{defaultSelected}}" data-selected="{{selected}}" data-disabled="{{disabled}}">{{{text}}}\n{{#if options}}\n<ul style="display:none">\n{{#each options}}\n<li data-role="item" class="{{../../../classPrefix}}-item {{#if disabled}}{{../../../../classPrefix}}-item-disabled{{/if}}" data-value="{{value}}" data-default-selected="{{defaultSelected}}" data-selected="{{selected}}" data-disabled="{{disabled}}">{{{text}}}\n{{#if options}}\n<ul style="display:none">\n{{#each options}}\n<li data-role="item" class="{{../../../../../classPrefix}}-item {{#if disabled}}{{../../../../../../classPrefix}}-item-disabled{{/if}}" data-value="{{value}}" data-default-selected="{{defaultSelected}}" data-selected="{{selected}}" data-disabled={{disabled}}>{{{text}}}</li>\n{{/each}}\n</ul>\n{{/if}}\n</li>\n{{/each}}\n</ul>\n{{/if}}\n</li>\n{{/each}}\n</ul>\n</div>',h=d.extend({Implements:f,attrs:{trigger:{value:null,getter:function(a){return e(a).eq(0)}},classPrefix:"ui-select",template:g,align:{baseXY:[0,"100%-1px"]},renderTrigger:function(a){a=a.clone(),e("ul",a).remove();var b=e.trim(a.html());return a.remove(),b},name:"",value:"",length:0,selectedIndex:-1,multiple:!1,disabled:!1,selectSource:null},events:{"click [data-role=item]":function(a){a.stopPropagation();var b=e(a.currentTarget);"true"!=b.attr("data-disabled")&&this.select(b)},"mouseenter [data-role=item]":function(a){e(a.currentTarget).addClass(this.get("classPrefix")+"-item-hover");var b=e(a.currentTarget).data("sub-overlay");b&&b._setPosition().show()},"mouseleave [data-role=item]":function(a){e(a.currentTarget).removeClass(this.get("classPrefix")+"-item-hover");var b=e(a.currentTarget).data("sub-overlay");b&&b.hide()}},initAttrs:function(a,b){h.superclass.initAttrs.call(this,a,b);var c=this.get("trigger");if("select"==c[0].tagName.toLowerCase()){var d=c.attr("name");d&&this.set("name",d),this.set("selectSource",c);var f='<a href="#" class="'+this.get("classPrefix")+'-trigger"></a>',g=e(f);this.set("trigger",g),c.after(g).hide(),this.model=i(c[0],this.get("classPrefix"))}else{var d=this.get("name");if(d){var k=e("input[name="+d+"]").eq(0);k[0]||(k=e('<input type="hidden" id="select-'+d+'" name="'+d+'" />').insertBefore(c)),this.set("selectSource",k)}this.model=j(this.model,this.get("classPrefix"))}},setup:function(){var a=this,b=this.get("trigger").on("click",{self:this},this._trigger_click).on("mouseenter",function(){b.addClass(a.get("classPrefix")+"-trigger-hover")}).on("mouseleave",function(){b.removeClass(a.get("classPrefix")+"-trigger-hover")});if(this.options=this.$("[data-role=content]").children(),this.set("multiple",n(this.model.options)),e("[data-selected=true]",this.element).is(e("[data-disabled=true]",this.element)))throw Error("A disabled item cannot be selected, check your model.");this.select("[data-selected=true]"),this.set("length",this.options.length),this._tweakAlignDefaultValue(),this._blurHide(b),this._initSubSelectPosition(),h.superclass.setup.call(this)},render:function(){return h.superclass.render.call(this),this._setTriggerWidth(),this},show:function(){return h.superclass.show.call(this),this},_setTriggerWidth:function(){var a=this.get("trigger"),b=this.element.outerWidth(),c=parseInt(a.css("padding-left"),10),d=parseInt(a.css("padding-right"),10),e=parseInt(a.css("border-left-width"),10),f=parseInt(a.css("border-right-width"),10);a.css("width",b-c-d-e-f)},_tweakAlignDefaultValue:function(){var a=this.get("align");"VIEWPORT"===a.baseElement._id&&(a.baseElement=this.get("trigger")),this.set("align",a)},_trigger_click:function(a){var b=a.data.self;a.preventDefault(),b.get("disabled")||b.show()},destroy:function(){e.each(this._overlays,function(a,b){b.destroy()}),this.element.remove(),h.superclass.destroy.call(this)},select:function(a){var b=k(a,this.options,this.get("multiple")),c=this.get("selectedIndex");if(this.set("selectedIndex",b),c!==b){var d=l(b,this.options);this.trigger("change",d)}return this.hide(),this},syncModel:function(a){return this.model=j(a,this.get("classPrefix")),this.set("multiple",n(this.model.options)),this.renderPartial("[data-role=content]"),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),this.set("selectedIndex",-1),this.set("value",""),this.select("[data-selected=true]"),this._setTriggerWidth(),this},getOption:function(a){var b=k(a,this.options,this.get("multiple"));return l(b,this.options)},addOption:function(a){var b=this.model.options;return b.push(a),this.syncModel(b),this},removeOption:function(a){var b=k(a,this.options,this.get("multiple")),c=this.get("selectedIndex"),d=l(b,this.options);return d.remove(),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),b===c?this.set("selectedIndex",0):c>b&&this.set("selectedIndex",c-1),this},_onRenderSelectedIndex:function(a){if(-1!=a){var b=l(a,this.options),c=this.currentItem,d=b.attr("data-value");if(!c||b[0]!=c[0]){if(c&&this.element.has(c)){c.attr("data-selected","false").removeClass(this.get("classPrefix")+"-item-selected");var f=m(k(c,this.options,this.get("multiple")),this.model.options);f&&(f.selected="false")}b.attr("data-selected","true").addClass(this.get("classPrefix")+"-item-selected");var f=m(a,this.model.options);f.selected="true",this.set("value",d);var g=this.get("trigger"),h=g.find("[data-role=trigger-content]"),i=this.get("renderTrigger").call(this,b);h.length?h.html(i):g.html(i);var j=this.get("selectSource");if(j){var n=j.val();j.val(d),d!==n&&e(j).trigger("change")}this.currentItem=b}}},_onRenderDisabled:function(a){var b=this.get("classPrefix")+"-disabled",c=this.get("trigger");c[a?"addClass":"removeClass"](b)},_initSubSelectPosition:function(){this._overlays=[];var a=e("li[data-role=item]",this.element),b=this;a.each(function(a,c){c=e(c);var f=c.children("ul");if(f.length>0){var g=new d({element:f,align:{baseElement:c,baseXY:["100%",0],selfXY:[0,0]}});c.data("sub-overlay",g),b._overlays.push(0)}})}});c.exports=h});